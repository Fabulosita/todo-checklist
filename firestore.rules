rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Basic rules for todos collection (development mode)
    match /todos/{todoId} {
      allow read, write: if true;
      allow create: if request.resource.data.keys().hasAll(['text', 'completed', 'createdAt', 'updatedAt']) &&
                   request.resource.data.text is string &&
                   request.resource.data.text.size() > 0 &&
                   request.resource.data.text.size() <= 500 &&
                   request.resource.data.completed is bool &&
                   request.resource.data.createdAt is timestamp &&
                   request.resource.data.updatedAt is timestamp &&
                   (!request.resource.data.keys().hasAny(['dueDate']) || request.resource.data.dueDate is string);
      allow update: if request.resource.data.keys().hasAll(['text', 'completed', 'updatedAt']) &&
                   request.resource.data.text is string &&
                   request.resource.data.text.size() > 0 &&
                   request.resource.data.text.size() <= 500 &&
                   request.resource.data.completed is bool &&
                   request.resource.data.updatedAt is timestamp &&
                   (!request.resource.data.keys().hasAny(['dueDate']) || request.resource.data.dueDate is string);
    }
  }
}